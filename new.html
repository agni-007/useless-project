<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Runaway Button ‚Äî Game Mode</title>
<style>
  :root{
    --bg1:#0f1724; --bg2:#082032;
    --accent1:#7ef192; --accent2:#5ad6c3;
  }
  html,body{
    height:100%;margin:0;
    font-family:Inter, "Segoe UI", Roboto, Arial;
  }
  body{
    background: radial-gradient(1200px 600px at 10% 20%, #06303a 0%, transparent 18%),
                radial-gradient(900px 400px at 90% 80%, #072b3a 0%, transparent 15%),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    display:flex;align-items:center;justify-content:center;color:#e6f7f1;
  }
  .stage{
    width:min(880px,92vw); padding:22px; border-radius:14px; text-align:center;
  }
  h1{ margin:4px 0 6px; font-weight:700; }
  p.lead{ margin:0 0 12px; color:#bdebe3; }

  .controls { display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:center; margin-bottom:14px; }
  input[type="range"] { width:220px; accent-color: #5ad6c3; }
  button{
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    border:none; border-radius:999px; padding:8px 18px;
    font-weight:700; cursor:pointer; color:#01302b;
    transition:transform .15s ease;
  }
  button:hover{transform:scale(1.05)}
  button:active{transform:scale(.96)}

  .arena{
    position:relative; width:100%; height:420px; border-radius:12px; overflow:hidden;
    background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    display:flex; align-items:center; justify-content:center;
    box-shadow: inset 0 2px 10px rgba(0,0,0,0.45);
  }

  /* Circular head button */
  #runawayBtn{
    position:absolute;
    width:100px; height:100px;
    border-radius:50%;
    overflow:hidden;
    background:none;
    border:none;
    box-shadow: 0 18px 40px rgba(0,0,0,0.45);
    cursor:pointer;
    user-select:none;
    transition: transform 160ms ease, box-shadow 160ms ease, left 220ms ease, top 220ms ease;
  }
  #runawayBtn:active { transform: scale(.96); }

  #runawayBtn img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    user-select: none;
    pointer-events: none;
  }

  .statusbar { display:flex; gap:10px; justify-content:center; margin-top:12px; color:#9beadf; font-weight:600; }
  .score { background:rgba(255,255,255,0.03); padding:6px 12px; border-radius:999px; }
  .timer { background:rgba(255,255,255,0.07); padding:6px 12px; border-radius:999px; font-weight:700; }

  /* Timeout overlay */
  .overlay{
    position:absolute; inset:0;
    background:rgba(0,0,0,0.85);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    color:#fff; font-size:1.4rem;
    opacity:0; pointer-events:none;
    transition:opacity 0.5s ease;
  }
  .overlay.show{opacity:1; pointer-events:auto;}
  .overlay .panel{
    background:rgba(255,255,255,0.05);
    padding:20px 30px; border-radius:12px; text-align:center;
    transform:scale(0.8);
    animation: popin 0.6s ease forwards;
  }
  @keyframes popin{
    to{transform:scale(1);}
  }
</style>
</head>
<body>
  <div class="stage" role="main">
    <h1>Runaway Button ‚Äî Game Mode</h1>
    <p class="lead">Catch it as many times as you can in 10 seconds!</p>

    <div class="controls">
      Difficulty:
      <input id="difficulty" type="range" min="1" max="10" value="5" />
      <span id="diffVal">5</span>
      <div class="score">Clicks: <span id="score">0</span></div>
      <div class="score">High Score: <span id="highscore">0</span></div>
      <div class="timer" id="timer">‚è≥ 10</div>
      <button id="startBtn">Start Game</button>
    </div>

    <div class="arena" id="arena" aria-live="polite">
      <div id="runawayBtn">
        <img id="playerHead" src="sanal.png" alt="Player's Head" />
      </div>
      <div class="overlay" id="overlay">
        <div class="panel">
          <h2>‚è∞ Time's Up!</h2>
          <p>Current Score: <span id="finalScore">0</span></p>
          <p>Difficulty: <span id="finalDiff">0</span></p>
          <p>üèÜ New High Score: <span id="finalHigh">0</span></p>
        </div>
      </div>
    </div>

    <div class="statusbar">
      <div id="hint">Tip: Don't corner it ‚Äî it will try harder there.</div>
    </div>
  </div>

<script>
const arena = document.getElementById('arena');
const btn = document.getElementById('runawayBtn');
const diff = document.getElementById('difficulty');
const diffVal = document.getElementById('diffVal');
const scoreEl = document.getElementById('score');
const highscoreEl = document.getElementById('highscore');
const startBtn = document.getElementById('startBtn');
const timerEl = document.getElementById('timer');
const overlay = document.getElementById('overlay');
const finalScoreEl = document.getElementById('finalScore');
const finalDiffEl = document.getElementById('finalDiff');
const finalHighEl = document.getElementById('finalHigh');

let score = 0, highscore = 0;
let btnX = 0, btnY = 0;
let safeDistance = 140;
let baseSpeed = 8;
let arenaW, arenaH;
let gameActive = false;
let countdown;

function updateArena() {
  arenaW = arena.clientWidth;
  arenaH = arena.clientHeight;
}
function placeCenter(){
  updateArena();
  btnX = Math.round((arenaW - btn.offsetWidth) / 2);
  btnY = Math.round((arenaH - btn.offsetHeight) / 2);
  applyPos();
}
function applyPos(){
  btn.style.left = btnX + 'px';
  btn.style.top = btnY + 'px';
}
function clampToArena(x,y){
  const minX = 6, minY = 6;
  const maxX = arenaW - btn.offsetWidth - 6;
  const maxY = arenaH - btn.offsetHeight - 6;
  return {
    x: Math.max(minX, Math.min(maxX, x)),
    y: Math.max(minY, Math.min(maxY, y))
  };
}
function clientToLocal(mouseClientX, mouseClientY){
  const rect = arena.getBoundingClientRect();
  return {
    x: mouseClientX - rect.left,
    y: mouseClientY - rect.top
  };
}
function computeParams(){
  const d = Number(diff.value);
  diffVal.textContent = d;
  const personalSpace = 120 + (d-5)*12;
  const speed = baseSpeed + d*6;
  return { personalSpace, speed };
}
function tryPerpendicularEscape(angleAway, curX, curY, speed, mouseLocal){
  for (let k = 0; k < 8; k++){
    const sign = (k%2===0)?1:-1;
    const extra = (k/8)*0.9;
    const perp = angleAway + sign*(Math.PI/2 + extra);
    const tx = curX + Math.cos(perp) * speed * 1.4;
    const ty = curY + Math.sin(perp) * speed * 1.4;
    const cl = clampToArena(tx,ty);
    const centerX = cl.x + btn.offsetWidth/2;
    const centerY = cl.y + btn.offsetHeight/2;
    const distToMouse = Math.hypot(centerX - mouseLocal.x, centerY - mouseLocal.y);
    if (Math.hypot(cl.x - curX, cl.y - curY) > 6 && distToMouse > 0.6 * computeParams().personalSpace) {
      return cl;
    }
  }
  return null;
}
function teleportAwayFrom(mouseLocal){
  for (let i=0;i<16;i++){
    const tx = Math.random()*(arenaW - btn.offsetWidth - 12) + 6;
    const ty = Math.random()*(arenaH - btn.offsetHeight - 12) + 6;
    const centerX = tx + btn.offsetWidth/2;
    const centerY = ty + btn.offsetHeight/2;
    const d = Math.hypot(centerX - mouseLocal.x, centerY - mouseLocal.y);
    if (d > computeParams().personalSpace * 1.1) {
      return { x: tx, y: ty };
    }
  }
  return { x: Math.round((arenaW - btn.offsetWidth)/2), y: Math.round((arenaH - btn.offsetHeight)/2) };
}

arena.addEventListener('mousemove', (ev) => {
  if (!gameActive) return;
  const mouseLocal = clientToLocal(ev.clientX, ev.clientY);
  const btnCenterX = btnX + btn.offsetWidth/2;
  const btnCenterY = btnY + btn.offsetHeight/2;
  const dx = mouseLocal.x - btnCenterX;
  const dy = mouseLocal.y - btnCenterY;
  const dist = Math.hypot(dx,dy);

  const params = computeParams();
  safeDistance = params.personalSpace;
  const speed = params.speed;

  if (dist < safeDistance) {
    let angleAway = Math.atan2(btnCenterY - mouseLocal.y, btnCenterX - mouseLocal.x);
    const proposedX = btnX + Math.cos(angleAway) * speed;
    const proposedY = btnY + Math.sin(angleAway) * speed;
    const clamped = clampToArena(proposedX, proposedY);

    if (Math.abs(clamped.x - btnX) < 1 && Math.abs(clamped.y - btnY) < 1) {
      const perp = tryPerpendicularEscape(angleAway, btnX, btnY, speed, mouseLocal);
      if (perp) {
        btnX = perp.x; btnY = perp.y;
      } else {
        const tp = teleportAwayFrom(mouseLocal);
        btnX = tp.x; btnY = tp.y;
      }
    } else {
      btnX = clamped.x; btnY = clamped.y;
    }
    applyPos();
  }
});

// Click handling with reaction head swap
btn.addEventListener('mousedown', (e) => {
  if (!gameActive) return;
  e.stopPropagation();
  score++;
  scoreEl.textContent = score;

  const headImg = document.getElementById('playerHead');
  const originalSrc = 'sanal.png';
  const reactionSrc = 'sanal1.png';
  headImg.src = reactionSrc;

  setTimeout(() => {
    headImg.src = originalSrc;
  }, 800);

  btn.style.transform = 'scale(0.96)';
  setTimeout(()=> btn.style.transform = '', 140);
  placeCenter();
});

// Start game logic
startBtn.addEventListener('click', () => {
  score = 0;
  scoreEl.textContent = score;
  gameActive = true;
  placeCenter();
  let timeLeft = 10;
  timerEl.textContent = `‚è≥ ${timeLeft}`;
  clearInterval(countdown);
  countdown = setInterval(() => {
    timeLeft--;
    timerEl.textContent = `‚è≥ ${timeLeft}`;
    if (timeLeft <= 0) {
      endGame();
    }
  }, 1000);
});

function endGame(){
  clearInterval(countdown);
  gameActive = false;
  finalScoreEl.textContent = score;
  finalDiffEl.textContent = diff.value;
  if (score > highscore) {
    highscore = score;
    highscoreEl.textContent = highscore;
  }
  finalHighEl.textContent = highscore;
  overlay.classList.add('show');
  setTimeout(() => {
    overlay.classList.remove('show');
    placeCenter();
  }, 3000);
}

window.addEventListener('resize', ()=> {
  updateArena();
  const cl = clampToArena(btnX, btnY);
  btnX = cl.x; btnY = cl.y;
  applyPos();
});

updateArena();
placeCenter();
diff.addEventListener('input', ()=> diffVal.textContent = diff.value);
</script>
</body>
</html>
